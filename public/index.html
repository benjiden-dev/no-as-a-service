<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NO.</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              brand: '#333333',
              'brand-strong': '#000000',
              'brand-medium': '#666666',
              'brand-subtle': '#999999',
              'neutral-primary': '#ffffff',
              'neutral-secondary-medium': '#f9fafb',
              'default-medium': '#d1d5db',
              'body': '#374151',
              'fg-brand': '#333333'
            },
            borderRadius: {
              'base': '0.375rem'
            },
            boxShadow: {
              'xs': '0 1px 2px 0 rgba(0, 0, 0, 0.05)'
            }
          }
        }
      }
    </script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="flex flex-col min-h-[100dvh] w-full bg-[#f0f0f0]">
    
    <!-- Main Content -->
    <div class="flex-grow flex items-center justify-center p-6 pb-24 w-full">
        <div class="container text-center max-w-[90vw]">
            <h1 id="reason" class="text-5xl md:text-9xl font-bold text-[#333] uppercase leading-tight transition-opacity duration-200">Loading...</h1>
        </div>
    </div>

    <!-- Hidden Input for Copying -->
    <input id="reason-text" type="text" class="sr-only" readonly>

    <!-- Bottom Right Controls -->
    <div class="fixed bottom-6 right-6 flex items-center gap-2 z-50">
        
        <!-- Image Link Button -->
        <a href="/M" target="_blank" id="img-link-btn" class="inline-flex items-center justify-center text-fg-brand bg-neutral-primary border border-brand hover:bg-brand hover:text-white focus:ring-4 focus:ring-brand-subtle rounded-base w-10 h-10 focus:outline-none transition-colors duration-200" title="Open Image (Medium)">
            <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m3 16 5-7 6 6.5m6.5 2.5L16 13l-4.286 6M14 10h.01M4 19h16a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1Z"/>
            </svg>
            <span class="sr-only">Open Image</span>
        </a>

        <!-- Reload Button -->
        <button type="button" onclick="fetchReason()" id="reload-btn" class="inline-flex items-center justify-center text-fg-brand bg-neutral-primary border border-brand hover:bg-brand hover:text-white focus:ring-4 focus:ring-brand-subtle rounded-base w-10 h-10 focus:outline-none transition-colors duration-200" title="Reload">
            <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.651 7.65a7.131 7.131 0 0 0-12.68 3.15M18.001 4v4h-4m-7.652 8.35a7.13 7.13 0 0 0 12.68-3.15M6 20v-4h4"/>
            </svg>
            <span class="sr-only">Reload</span>
        </button>

        <!-- Copy Button -->
        <button onclick="copyToClipboard()" id="copy-btn" class="inline-flex items-center justify-center text-fg-brand bg-neutral-primary border border-brand hover:bg-brand hover:text-white focus:ring-4 focus:ring-brand-subtle rounded-base w-10 h-10 focus:outline-none transition-all duration-200" title="Copy to Clipboard">
            <span id="default-message" class="inline-flex items-center justify-center">
                <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2M9 5a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2M9 5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2"/>
                </svg>
            </span>
            <span id="success-message" class="hidden inline-flex items-center justify-center">
                <svg class="w-5 h-5 text-green-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 11.917 9.724 16.5 19 7.5"/>
                </svg>
            </span>
            <span class="sr-only">Copy</span>
        </button>
    </div>

    <script>
        async function fetchReason() {
            const reasonEl = document.getElementById('reason');
            const inputEl = document.getElementById('reason-text');
            const btn = document.getElementById('reload-btn');
            const imgBtn = document.getElementById('img-link-btn');
            
            reasonEl.style.opacity = '0.5';
            btn.classList.add('bg-brand', 'text-white'); 
            
            try {
                const response = await fetch('/no');
                const data = await response.json();
                reasonEl.innerText = data.reason;
                inputEl.value = data.reason;
                // Update Image Button Link with encoded reason
                imgBtn.href = `/M?reason=${encodeURIComponent(data.reason)}`;
            } catch (error) {
                console.error('Error fetching reason:', error);
                reasonEl.innerText = "NO.";
                inputEl.value = "NO.";
                imgBtn.href = "/M?reason=NO.";
            } finally {
                reasonEl.style.opacity = '1';
                setTimeout(() => {
                    btn.classList.remove('bg-brand', 'text-white');
                }, 200);
            }
        }

        function copyToClipboard() {
            const copyText = document.getElementById("reason-text");
            navigator.clipboard.writeText(copyText.value).then(() => {
                showCopiedFeedback();
            }).catch(err => {
                copyText.select();
                document.execCommand("copy");
                showCopiedFeedback();
            });
        }

        function showCopiedFeedback() {
            const defaultMsg = document.getElementById('default-message');
            const successMsg = document.getElementById('success-message');
            const copyBtn = document.getElementById('copy-btn');

            defaultMsg.classList.add('hidden');
            successMsg.classList.remove('hidden');
            copyBtn.classList.add('bg-brand', 'text-white');

            setTimeout(() => {
                defaultMsg.classList.remove('hidden');
                successMsg.classList.add('hidden');
                copyBtn.classList.remove('bg-brand', 'text-white');
            }, 2000);
        }
        
        // Check configuration and fetch initial reason
        async function init() {
            try {
                const configRes = await fetch('/config');
                const config = await configRes.json();
                
                if (!config.imagesEnabled) {
                    const imgBtn = document.getElementById('img-link-btn');
                    if (imgBtn) imgBtn.classList.add('hidden');
                }
            } catch (e) {
                console.error('Failed to fetch config', e);
            }
            fetchReason();
        }

        init();
    </script>
</body>
</html>